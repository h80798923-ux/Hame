<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Onur Chatting</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js"></script>
  <!-- Stil -->
  <style>
    body{margin:0;font-family:sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;height:100vh}
    header{background:#075E54;color:#fff;padding:10px;display:flex;align-items:center;justify-content:space-between}
    #chat{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column}
    .msg{max-width:70%;padding:10px;margin:5px;border-radius:10px;word-wrap:break-word;position:relative}
    .me{background:#005c99;color:#fff;align-self:flex-end}
    .other{background:#262d31;color:#fff;align-self:flex-start}
    .msg small{font-size:10px;opacity:0.7;display:block;text-align:right}
    #inputArea{display:flex;padding:10px;background:#1f2c34}
    #msgInput{flex:1;padding:10px;border:none;border-radius:20px;outline:none}
    button{background:#128C7E;color:#fff;border:none;padding:10px 15px;border-radius:50%;margin-left:5px;cursor:pointer}
    #statusArea{display:none;background:#000;border-top:1px solid #333;max-height:150px;overflow:auto}
    .statusItem{padding:5px;border-bottom:1px solid #333}
    #login{position:fixed;top:0;left:0;width:100%;height:100%;background:#111;display:flex;flex-direction:column;justify-content:center;align-items:center;z-index:1000}
    #login input{margin:5px;padding:10px;border-radius:10px;border:none}
    #profile{display:flex;align-items:center;gap:10px}
    img.pf{width:35px;height:35px;border-radius:50%}
    .deleteBtn{position:absolute;top:3px;right:5px;font-size:12px;background:red;padding:2px 6px;border-radius:8px;cursor:pointer}
  </style>
</head>
<body>
  <div id="login">
    <h2>Onur Chatting</h2>
    <input id="username" placeholder="KullanÄ±cÄ± adÄ±n">
    <input type="file" id="pfInput">
    <button onclick="startChat()">GiriÅŸ Yap</button>
  </div>

  <header>
    <div id="profile"><img id="pfPic" class="pf"> <span id="userLabel"></span></div>
    <button id="statusBtn">ðŸ“¢</button>
  </header>

  <div id="statusArea">
    <input id="statusInput" placeholder="Durum yaz...">
    <button id="addStatusBtn">âž•</button>
    <div id="statusList"></div>
  </div>

  <div id="chat"></div>

  <div id="inputArea">
    <input id="msgInput" placeholder="Mesaj yaz...">
    <button onclick="sendMsg()">âž¤</button>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getDatabase, ref, push, onChildAdded, remove, update } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

  // Senin Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyCGtiscjlxNrjMy0JIWSmg1xJ5Beqpe_1o",
    authDomain: "messen-7526f.firebaseapp.com",
    databaseURL: "https://messen-7526f-default-rtdb.firebaseio.com",
    projectId: "messen-7526f",
    storageBucket: "messen-7526f.appspot.com",
    messagingSenderId: "586198763347",
    appId: "1:586198763347:web:4fb30c0a8018f4228f03a6"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  let username = "", pfBase64 = "";

  window.startChat = () => {
    const u = document.getElementById("username").value.trim();
    if(!u) return alert("Ad gir!");
    username = u;
    document.getElementById("userLabel").innerText = u;
    if(pfBase64) document.getElementById("pfPic").src = pfBase64;
    document.getElementById("login").style.display="none";
  };

  document.getElementById("pfInput").onchange = function(e){
    const file = e.target.files[0];
    if(file){
      const reader = new FileReader();
      reader.onload = () => { pfBase64 = reader.result; };
      reader.readAsDataURL(file);
    }
  };

  const messagesRef = ref(db,"messages");
  const statusRef = ref(db,"status");

  window.sendMsg = () => {
    const text = document.getElementById("msgInput").value.trim();
    if(text){
      push(messagesRef,{
        user: username,
        text: text,
        pf: pfBase64,
        time: Date.now()
      });
      document.getElementById("msgInput").value="";
    }
  };

  onChildAdded(messagesRef, (data)=>{
    const msg = data.val();
    const div = document.createElement("div");
    div.classList.add("msg");
    div.classList.add(msg.user === username ? "me":"other");
    if(msg.pf) div.innerHTML=`<img src="${msg.pf}" class="pf"> `;
    div.innerHTML+= `<b>${msg.user}</b><br>${msg.text}<br><small>${new Date(msg.time).toLocaleTimeString()}</small>`;
    if(msg.user===username){ 
      const del=document.createElement("div");
      del.className="deleteBtn";
      del.innerText="ðŸ—‘";
      del.onclick=()=>remove(data.ref);
      div.appendChild(del);
    }
    document.getElementById("chat").appendChild(div);
    document.getElementById("chat").scrollTop=document.getElementById("chat").scrollHeight;
  });

  // durum ekleme
  document.getElementById("addStatusBtn").onclick=()=>{
    const text=document.getElementById("statusInput").value.trim();
    if(text){
      push(statusRef,{user:username,text:text,time:Date.now()});
      document.getElementById("statusInput").value="";
    }
  };

  onChildAdded(statusRef,(snap)=>{
    const s=snap.val();
    const div=document.createElement("div");
    div.className="statusItem";
    div.innerText=`${s.user}: ${s.text}`;
    document.getElementById("statusList").appendChild(div);
  });

  document.getElementById("statusBtn").onclick=()=>{
    const area=document.getElementById("statusArea");
    area.style.display=area.style.display==="none"?"block":"none";
  };
</script>
</body>
</html>
